<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Loja Custom Gears</title>
  <style>
    body { background: #000; color: #fff; font-family: Arial, sans-serif; }
    .product { border: 1px solid #fff; padding: 10px; margin-bottom: 20px; }
    select, input[type="number"] { margin-bottom: 10px; }
    button { background: purple; color: white; border: none; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Produtos Custom Gears</h1>

<div id="product-list"></div>

<h2>Carrinho</h2>
<ul id="cart-list"></ul>

<script>
const products = [
  {
    id: 1,
    name: "Camiseta Custom Gears",
    price: 120,
    sizes: ["P", "M", "G"],
    colors: [
      { name: "Preto", stock: 3 },
      { name: "Branco", stock: 2 }
    ],
    image: "https://via.placeholder.com/150"
  },
  {
    id: 2,
    name: "Boné Custom Gears",
    price: 80,
    sizes: [],
    colors: [
      { name: "Preto", stock: 1 },
      { name: "Roxo", stock: 1 }
    ],
    image: "https://via.placeholder.com/150"
  }
];

let cart = [];

function renderProducts() {
  const productList = document.getElementById('product-list');
  productList.innerHTML = '';

  products.forEach(p => {
    let sizeSel = '';
    if (p.sizes.length) {
      sizeSel = `<label>Tamanho: </label><select id="size-${p.id}">` +
        p.sizes.map(size => `<option value="${size}">${size}</option>`).join('') +
        `</select><br>`;
    }

    // Só mostra cores que ainda têm estoque
    let availableColors = p.colors.filter(c => c.stock > 0);
    if (availableColors.length === 0) {
      productList.innerHTML += `
        <div class="product">
          <img src="${p.image}" alt="${p.name}" style="width:100px;"><br>
          <strong>${p.name}</strong><br>
          <span style="color: red;">Produto Esgotado</span>
        </div>
      `;
      return;
    }

    let colorSel = `<label>Cor: </label><select id="color-${p.id}">` +
      availableColors.map(c => `<option value="${c.name}">${c.name} (${c.stock} disponíveis)</option>`).join('') +
      `</select><br>`;

    let qtyInput = `<label>Quantidade: </label><input type="number" id="qty-${p.id}" value="1" min="1" style="width:60px;"><br>`;

    productList.innerHTML += `
      <div class="product">
        <img src="${p.image}" alt="${p.name}" style="width:100px;"><br>
        <strong>${p.name}</strong><br>
        R$${p.price}<br><br>
        ${sizeSel}
        ${colorSel}
        ${qtyInput}
        <button onclick="addToCart(${p.id})">Adicionar ao Carrinho</button>
      </div>
    `;
  });
}

function addToCart(productId) {
  const sizeSelect = document.getElementById(`size-${productId}`);
  const colorSelect = document.getElementById(`color-${productId}`);
  const qtyInput = document.getElementById(`qty-${productId}`);

  if (!colorSelect) {
    alert('Produto sem cores disponíveis.');
    return;
  }

  const size = sizeSelect ? sizeSelect.value : '';
  const color = colorSelect.value;
  const qty = parseInt(qtyInput.value);

  const product = products.find(p => p.id === productId);
  const colorStock = product.colors.find(c => c.name === color);

  if (!colorStock) {
    alert('Cor inválida.');
    return;
  }

  if (qty > colorStock.stock) {
    alert(`Só temos ${colorStock.stock} unidades disponíveis dessa cor.`);
    return;
  }

  colorStock.stock -= qty; // Diminui estoque

  cart.push({
    id: product.id,
    name: product.name,
    price: product.price,
    size: size,
    color: color,
    quantity: qty
  });

  updateCart();
  renderProducts(); // Atualiza lista, removendo a cor se esgotar
}

function updateCart() {
  const cartList = document.getElementById('cart-list');
  cartList.innerHTML = '';

  cart.forEach(item => {
    cartList.innerHTML += `<li>${item.quantity}x ${item.name} - Cor: ${item.color} ${item.size ? '- Tamanho: ' + item.size : ''} - R$${item.price * item.quantity}</li>`;
  });
}

// Inicializa
renderProducts();
</script>

</body>
</html>
