<!-- Correção e melhorias já aplicadas -->
<button onclick="scrollToTop()" id="btnTop" title="Voltar ao Topo">↑</button>

<script>
  const products = [
    { id:1, name:'Camiseta oversized Custom Gears', price:119.90, img:'https://i.postimg.cc/G3zD0FLD/camisa1.jpg', sizes:['P','M','G','GG','XG'], colors:['Preto','Branco','Roxo','Cinza'] },
    { id:2, name:'Blusa moletom Custom Gears', price:159.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', sizes:['P','M','G','GG','XG'], colors:['Preto','Branco','Roxo','Cinza'] },
    { id:3, name:'Manopla câmbio Custom Gears', price:65.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Roxo','Cinza'] },
    { id:4, name:'Bandeira Custom Gears', price:54.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo','Cinza'] },
    { id:5, name:'Coifa câmbio Custom Gears', price:59.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo','Cinza'] },
    { id:6, name:'Caneca personalizada Custom Gears', price:59.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo','Cinza'] },
    { id:7, name:'Chaveiro e cordão Custom Gears', price:29.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo','Cinza'] },
    { id:8, name:'Adesivos refletivo Custom Gears', price:19.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo'] },
    { id:9, name:'Aromatizante automotivo Custom Gears', price:6.90, img:'https://i.postimg.cc/nVqD3dzV/chaveiro1.jpg', colors:['Preto','Branco','Roxo','Cinza'] }
  ];
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  function renderProducts(list = products) {
    const productList = document.getElementById('productList');
    productList.innerHTML = '';
    list.forEach(p => {
      const div = document.createElement('div');
      div.className = 'product';
      let sizeSel = p.sizes ? `<select id="size-${p.id}"><option value="">Tamanho</option>${p.sizes.map(s => `<option value="${s}">${s}</option>`).join('')}</select>` : '';
      let colorSel = p.colors ? `<select id="color-${p.id}"><option value="">Cor</option>${p.colors.map(c => `<option value="${c}">${c}</option>`).join('')}</select>` : '';
      div.innerHTML = `<img src="${p.img}" alt="${p.name}"><h3>${p.name}</h3><p>R$${p.price.toFixed(2)}</p>${sizeSel}${colorSel}<button onclick="addToCart(${p.id})">Adicionar ao Carrinho</button>`;
      productList.appendChild(div);
    });
  }
  function addToCart(id) {
    const p = products.find(x => x.id === id);
    const sz = document.getElementById(`size-${id}`)?.value || '';
    const col = document.getElementById(`color-${id}`)?.value || '';
    if (p.sizes && !sz) { showAlert('Selecione um tamanho'); return; }
    if (p.colors && !col) { showAlert('Selecione uma cor'); return; }
    const key = `${id}-${sz}-${col}`;
    let exist = cart.find(x => x.key === key);
    if (exist) exist.quantity++;
    else cart.push({...p, quantity:1, size:sz, color:col, key});
    saveCart(); updateCartCount(); showAlert(`${p.name} adicionado!`);
  }
  function renderCartItems() {
    const el = document.getElementById('cartItems');
    el.innerHTML = '';
    let tot = 0;
    cart.forEach(i => {
      tot += i.price * i.quantity;
      el.innerHTML += `<p>${i.name}${i.size ? ` (${i.size})` : ''}${i.color ? ` - ${i.color}` : ''} x${i.quantity} - R$${(i.price*i.quantity).toFixed(2)} <button class="remove" onclick="removeFromCart('${i.key}')">X</button></p>`;
    });
    document.getElementById('cartTotal').innerText = `Total: R$${tot.toFixed(2)}`;
  }
  function removeFromCart(key) {
    cart = cart.filter(x => x.key !== key);
    saveCart(); updateCartCount(); renderCartItems();
  }
  function saveCart() { localStorage.setItem('cart', JSON.stringify(cart)); }
  function updateCartCount() {
    document.getElementById('cartCount').innerText = cart.reduce((a, i) => a + i.quantity, 0);
  }
  function toggleCartPopup() {
    let pop = document.querySelector('.cart-popup');
    if (!pop) createCartPopup();
    document.querySelector('.cart-popup').style.display = 'flex';
    renderCartItems();
  }
  function createCartPopup() {
    const pop = document.createElement('div');
    pop.className = 'cart-popup';
    pop.innerHTML = `<div class="cart-content"><h3>Seu Carrinho</h3><div id="cartItems"></div><p id="cartTotal"></p><button onclick="checkout()" class="checkout">Finalizar Compra</button><button onclick="closeCart()" style="margin-top:1rem">Fechar</button></div>`;
    document.body.appendChild(pop);
  }
  function closeCart() {
    document.querySelector('.cart-popup').style.display = 'none';
  }
  function checkout() {
    let sum = generateOrderSummary();
    const url = `https://wa.me/5541999737694?text=${encodeURIComponent(sum)}`;
    window.location.href = url;
    cart = []; saveCart(); updateCartCount(); closeCart();
  }
  function generateOrderSummary() {
    let s = '';
    cart.forEach(i => s += `${i.quantity}x ${i.name}${i.size ? ` (${i.size})` : ''}${i.color ? ` - ${i.color}` : ''} (R$${(i.price*i.quantity).toFixed(2)})\n`);
    s += `Total: R$${cart.reduce((a,i)=>a+i.price*i.quantity,0).toFixed(2)}`;
    return s;
  }
  function filterProducts() {
    const t = document.getElementById('searchInput').value.toLowerCase();
    renderProducts(products.filter(p => p.name.toLowerCase().includes(t)));
  }
  function showAlert(msg) {
    const a = document.createElement('div');
    a.className = 'custom-alert';
    a.innerText = msg;
    document.body.appendChild(a);
    setTimeout(() => a.remove(), 2000);
  }
  window.onscroll = () => toggleBtnTop();
  function toggleBtnTop() {
    const b = document.getElementById('btnTop');
    (document.documentElement.scrollTop > 200 || document.body.scrollTop > 200) ? b.style.display = 'block' : b.style.display = 'none';
  }
  function scrollToTop() {
    window.scrollTo({top: 0, behavior: 'smooth'});
  }
  // Inicialização
  renderProducts();
  updateCartCount();
</script>

<style>
/* Ajuste botão Topo */
#btnTop {
  display: none;
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 999;
  font-size: 2rem;
  border: none;
  outline: none;
  background: #800080;
  color: white;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  text-align: center;
  line-height: 40px;
  box-shadow: 0 0 10px #800080;
  transition: background 0.3s;
}
#btnTop:hover {
  background: #a020f0;
}
</style>
