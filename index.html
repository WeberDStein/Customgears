<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Gears</title>
  <meta name="description" content="Custom Gears - AcessÃ³rios personalizados para carros e estilo streetwear." />
  <meta name="keywords" content="custom gears, acessÃ³rios carros, streetwear, jdm, tuning" />

  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* ... SEU CSS EXISTENTE SEM ALTERAÃ‡Ã•ES ... */
  </style>
</head>

<body>

  <!-- Carrinho -->
  <div class="cart" onclick="toggleCartPopup()">
    ðŸ›’ Carrinho <span class="cart-count" id="cartCount">0</span>
  </div>

  <!-- CabeÃ§alho -->
  <header>Custom Gears</header>

  <!-- SeÃ§Ã£o Produtos -->
  <div class="container">
    <h2>Produtos</h2>
    <input type="text" id="searchInput" placeholder="Buscar produtos..." oninput="filterProducts()">
    <div class="products" id="productList"></div>
  </div>

  <!-- InformaÃ§Ãµes -->
  <div class="container">
    <h2>Para mais informaÃ§Ãµes</h2>
    <div class="catalog">
      <!-- ConteÃºdo futuro -->
    </div>
  </div>

  <!-- RodapÃ© -->
  <footer>
    <!-- ... SEU FOOTER EXISTENTE ... -->
  </footer>

  <!-- BotÃ£o Voltar ao Topo -->
  <button onclick="scrollToTop()" id="btnTop" title="Voltar ao Topo">â†‘</button>

  <!-- Scripts -->
  <script>
    // 1. Estoque por cor e tamanho (aplicado ao produto de ID 8)
    const stock = {
      8: {
        preto: { P: 5, M: 5, G: 5 },
        branco: { P: 3, M: 3, G: 3 },
        roxo: { P: 4, M: 4, G: 4 }
      }
    };

    const products = [
      { id: 1, name: 'Camiseta oversized Custom Gears', price: 119.90, img: 'https://i.postimg.cc/G3zD0FLD/camisa1.jpg' },
      { id: 2, name: 'Blusa moletom Custom Gears', price: 159.90, img: 'https://i.postimg.cc/dtZXDB2x/manopla1.jpg' },
      { id: 3, name: 'Manopla cÃ¢mbio Custom Gears', price: 65.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 4, name: 'Bandeira Custom Gears', price: 54.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 5, name: 'Coifa cÃ¢mbio Custom Gears', price: 59.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 6, name: 'Caneca personalizada Custom Gears', price: 59.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 7, name: 'Chaveiro e cordÃ£o Custom Gears', price: 29.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 8, name: 'Adesivos refletivo Custom Gears', price: 19.90, img: 'https://i.postimg.cc/J04rPZ4y/volante1.jpg' },
      { id: 9, name: 'Aromatizante automotivo Custom Gears', price: 6.90, img: 'https://i.postimg.cc/nVqD3dzV/chaveiro1.jpg' }
    ];

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function renderProducts(list = products) {
      const productList = document.getElementById('productList');
      productList.innerHTML = '';
      list.forEach(p => {
        const hasVariants = stock[p.id] !== undefined;
        const div = document.createElement('div');
        div.className = 'product';

        let variantHTML = '';
        if (hasVariants) {
          // monta selects de Cor, Tamanho e Quantidade
          const colors = Object.keys(stock[p.id]);
          variantHTML += `<label>Cor:</label>
            <select id="colorSelect-${p.id}">
              ${colors.map(c => `<option value="${c}">${c.charAt(0).toUpperCase()+c.slice(1)}</option>`).join('')}
            </select>`;

          variantHTML += `<label>Tamanho:</label>
            <select id="sizeSelect-${p.id}">
              ${Object.keys(stock[p.id][colors[0]]).map(sz => `<option value="${sz}">${sz}</option>`).join('')}
            </select>`;

          variantHTML += `<label>Qtd:</label>
            <input type="number" id="qtyInput-${p.id}" min="1" value="1" style="width:50px;">`;
        }

        const buttonLabel = hasVariants ? 'Adicionar ao Carrinho' : 'Adicionar ao Carrinho';
        const disabled = hasVariants && Object.keys(stock[p.id]).length === 0 ? 'disabled' : '';

        div.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>R$${p.price.toFixed(2)}</p>
          ${variantHTML}
          <button ${disabled} onclick="addToCart(${p.id})">${hasVariants ? buttonLabel : buttonLabel}</button>
        `;
        productList.appendChild(div);
      });
    }

    function addToCart(id) {
      const product = products.find(p => p.id === id);
      const variant = stock[id];
      let color, size, qty;

      if (variant) {
        color = document.getElementById(`colorSelect-${id}`).value;
        size  = document.getElementById(`sizeSelect-${id}`).value;
        qty   = parseInt(document.getElementById(`qtyInput-${id}`).value);

        const available = variant[color][size] || 0;
        if (available === 0) {
          return showAlert(` ${product.name} (${color.toUpperCase()} ${size}) indisponÃ­vel.`);
        }
        if (qty > available) {
          return showAlert(`SÃ³ temos ${available} unid. de ${color.toUpperCase()} (${size}).`);
        }

        // decrementa estoque
        variant[color][size] -= qty;

        // se size esgotou, remove do select
        if (variant[color][size] === 0) {
          const sizeSel = document.getElementById(`sizeSelect-${id}`);
          sizeSel.querySelector(`option[value="${size}"]`).remove();
        }
        // se cor toda esgotou, remove do select e reseta tamanho
        if (Object.values(variant[color]).every(v => v === 0)) {
          delete variant[color];
          document.getElementById(`colorSelect-${id}`)
            .querySelector(`option[value="${color}"]`).remove();
        }
        // se nÃ£o hÃ¡ mais cores, desabilita botÃ£o e avisa
        if (Object.keys(variant).length === 0) {
          const btn = document.querySelector(`.product button[onclick="addToCart(${id})"]`);
          btn.disabled = true;
          btn.innerText = 'Esgotado';
        }
      } else {
        // comportamento antigo para produtos sem variantes
        qty = 1;
      }

      // adiciona ao carrinho
      const exists = cart.find(item =>
        item.id === id && item.color === color && item.size === size
      );
      if (exists) {
        exists.quantity += qty;
      } else {
        cart.push({ id, name: product.name, price: product.price, quantity: qty, color, size });
      }

      saveCart();
      updateCartCount();
      showAlert(`${product.name} adicionado ao carrinho!`);
    }

    // ... FunÃ§Ãµes de carrinho (saveCart, updateCartCount, toggleCartPopup, renderCartItems etc.) ...
    // Agora elas passam a exibir color e size:
    function renderCartItems() {
      const cartItems = document.getElementById('cartItems');
      cartItems.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
        const variantText = item.color ? ` (${item.color.toUpperCase()} / ${item.size})` : '';
        cartItems.innerHTML += `
          <p>${item.name}${variantText} x${item.quantity} - R$${(item.price * item.quantity).toFixed(2)}
            <button class="remove" onclick="removeFromCart(${item.id}, '${item.color}', '${item.size}')">X</button>
          </p>`;
      });
      document.getElementById('cartTotal').innerText = `Total: R$${total.toFixed(2)}`;
    }

    function removeFromCart(id, color, size) {
      cart = cart.filter(item =>
        !(item.id === id && item.color === color && item.size === size)
      );
      saveCart();
      updateCartCount();
      renderCartItems();
    }

    // restante das funÃ§Ãµes (checkout, generateOrderSummary, filterProducts, showAlert, scrollToTop etc.)
    // sem alteraÃ§Ãµes relevantes para o estoque

    // InicializaÃ§Ã£o
    renderProducts();
    updateCartCount();
  </script>

</body>
</html>
