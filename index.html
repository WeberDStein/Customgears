<!-- ... Seu HTML anterior permanece igual até a parte do script -->
<script>
  const products = [
    { id:1, name:'Camiseta oversized Custom Gears', price:119.90, img:'https://i.postimg.cc/G3zD0FLD/camisa1.jpg', sizes:['P','M','G','GG','XG'], colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:5,Branco:5,Roxo:5,Cinza:5} },
    { id:2, name:'Blusa moletom Custom Gears', price:159.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', sizes:['P','M','G','GG','XG'], colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:3,Branco:2,Roxo:4,Cinza:1} },
    { id:3, name:'Manopla câmbio Custom Gears', price:65.90, img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:2,Branco:3,Roxo:2,Cinza:1} },
    { id:4, name:'Chaveiro Custom Gears', price:29.90, img:'https://i.postimg.cc/8CmjdN1L/chaveiro.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:10,Branco:10,Roxo:10,Cinza:10} },
    { id:5, name:'Adesivo Refletivo Custom Gears', price:15.00, img:'https://i.postimg.cc/15YLM4Yt/adesivo.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:20,Branco:20,Roxo:20,Cinza:20} },
    { id:6, name:'Coifa para câmbio Custom Gears', price:79.90, img:'https://i.postimg.cc/NjPC3FF1/coifa.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:5,Branco:5,Roxo:5,Cinza:5} },
    { id:7, name:'Aromatizante de carro Custom Gears', price:9.90, img:'https://i.postimg.cc/SRNWmJcw/aromatizante.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:15,Branco:15,Roxo:15,Cinza:15} },
    { id:8, name:'Copo personalizado Custom Gears', price:49.90, img:'https://i.postimg.cc/SxhJ8rj8/copo.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:8,Branco:8,Roxo:8,Cinza:8} },
    { id:9, name:'Cordão de pescoço Custom Gears', price:19.90, img:'https://i.postimg.cc/W4F5KgT3/cordao.jpg', colors:['Preto','Branco','Roxo','Cinza'], stock:{Preto:12,Branco:12,Roxo:12,Cinza:12} }
  ];

  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  function renderProducts(list = products) {
    const container = document.getElementById('productList');
    container.innerHTML = '';

    list.forEach(p => {
      const available = p.colors.filter(c => p.stock[c] > 0);
      const card = document.createElement('div');
      card.className = 'product';

      const existingColor = document.getElementById(`color-${p.id}`)?.value;
      const existingSize = document.getElementById(`size-${p.id}`)?.value;
      const existingQty = document.getElementById(`qty-${p.id}`)?.value;

      if (!available.length) {
        card.innerHTML = `<span class="sold-out">Esgotado</span>
                          <img src="${p.img}" alt="${p.name}">
                          <h3>${p.name}</h3>
                          <p>R$${p.price.toFixed(2)}</p>`;
      } else {
        const sizeSel = p.sizes ?
          `<label for="size-${p.id}">Tamanho</label>
           <select id="size-${p.id}" aria-label="Selecione o tamanho">
             <option value="">Selecione</option>
             ${p.sizes.map(s => `<option value="${s}" ${s === existingSize ? 'selected' : ''}>${s}</option>`).join('')}
           </select>` : '';

        const colorSel = `<label for="color-${p.id}">Cor</label>
                          <select id="color-${p.id}" onchange="updateQtyMax(${p.id})" aria-label="Selecione a cor">
                            <option value="">Selecione</option>
                            ${available.map(c =>
                              `<option value="${c}" ${c === existingColor ? 'selected' : ''}>
                                 ${c} (${p.stock[c]})
                               </option>`).join('')}
                          </select>`;

        const qty = `<label for="qty-${p.id}">Quantidade</label>
                     <input type="number" id="qty-${p.id}"
                           min="1"
                           value="${existingQty || 1}"
                           ${!existingColor ? 'disabled' : ''}
                           aria-label="Selecione a quantidade">`;

        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>R$${p.price.toFixed(2)}</p>
          ${sizeSel}
          ${colorSel}
          ${qty}
          <button onclick="addToCart(${p.id})"
                  ${!existingColor ? 'disabled' : ''}>
            Adicionar
          </button>`;
      }
      container.appendChild(card);
      if (existingColor) updateQtyMax(p.id);
    });
  }

  function addToCart(id) {
    const product = products.find(p => p.id === id);
    const color = document.getElementById(`color-${id}`).value;
    const sizeEl = document.getElementById(`size-${id}`);
    const qty = parseInt(document.getElementById(`qty-${id}`).value);

    if (!color || qty < 1 || isNaN(qty)) {
      alert("Selecione a cor e quantidade corretamente.");
      return;
    }

    const size = sizeEl ? sizeEl.value : null;
    if (sizeEl && !size) {
      alert("Selecione o tamanho.");
      return;
    }

    const existing = cart.find(item => item.id === id && item.color === color && item.size === size);
    if (existing) {
      existing.qty += qty;
    } else {
      cart.push({ id, name: product.name, price: product.price, color, size, qty });
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
    showAlert("Produto adicionado ao carrinho!");
  }

  function showAlert(msg) {
    const alertBox = document.createElement('div');
    alertBox.className = 'custom-alert';
    alertBox.textContent = msg;
    document.body.appendChild(alertBox);
    setTimeout(() => alertBox.remove(), 2000);
  }

  function updateCartCount() {
    const count = cart.reduce((sum, item) => sum + item.qty, 0);
    document.getElementById('cartCount').textContent = count;
  }

  renderProducts();
  updateCartCount();
</script>
