<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>𝕮𝖚𝖘𝖙𝖔𝖒 𝖌𝖊𝖆𝖗𝖘</title>
  <meta name="description" content="Custom Gears - Acessórios personalizados para carros e estilo streetwear." />
  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ... estilos existentes ... */
  </style>
</head>
<body>
  <div class="cart" onclick="toggleCartPopup()">
    🛒 Carrinho <span class="cart-count" id="cartCount">0</span>
  </div>
  <header>Custom Gears</header>
  <div class="container">
    <h2>Produtos</h2>
    <div class="products" id="productList"></div>
  </div>
  <footer>
    <!-- ... footer ... -->
  </footer>
  <div class="cart-popup" id="cartPopup">
    <div class="cart-content">
      <h3>Seu Carrinho</h3>
      <div id="cartItems"></div>
      <p id="cartTotal"></p>
      <button onclick="checkout()" class="checkout">Chamar no WhatsApp</button>
      <button onclick="closeCart()" style="margin-top:1rem;">Fechar</button>
    </div>
  </div>
  <button onclick="scrollToTop()" id="btnTop" title="Voltar ao Topo">↑</button>
  <script>
    // Definição dos produtos
    const products = [ /* ... array de produtos ... */ ];// Inicializa ou carrega o inventário no localStorage
function initInventory() {
  const inv = {};
  products.forEach(p => {
    inv[p.id] = {};
    const cols = p.colors || [];
    const szs = p.sizes || [];
    cols.forEach(c => szs.forEach(s => inv[p.id][`${c}|${s}`] = 5));
  });
  return inv;
}
let inventory = JSON.parse(localStorage.getItem('inventory')) || initInventory();
function saveInventory() {
  localStorage.setItem('inventory', JSON.stringify(inventory));
}

// Carrega ou inicia carrinho
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// Renderiza produtos na página
function renderProducts() {
  const list = document.getElementById('productList'); list.innerHTML = '';
  products.forEach(p => {
    const card = document.createElement('div'); card.className = 'product'; card.id = `prod-${p.id}`;
    const available = Object.entries(inventory[p.id]).filter(([_, q]) => q > 0);
    if (available.length === 0) {
      card.innerHTML = `<img src="${p.img}" alt="${p.name}"/><h3>${p.name}</h3><span class="sold-out-text">Esgotado</span>`;
    } else {
      const cols = [...new Set(available.map(([k]) => k.split('|')[0]))];
      const szs = [...new Set(available.map(([k]) => k.split('|')[1]))];
      const defC = cols[0], defS = szs[0];
      const price = p.sizePrices? p.sizePrices[defS] : p.price;
      card.innerHTML = `
        <img src="${p.img}" alt="${p.name}" />
        <h3>${p.name}</h3>
        <p class="price">R$${price.toFixed(2)}</p>
        <p class="stock-label">Estoque: ${inventory[p.id][`${defC}|${defS}`]}</p>
        <label>Cor: <select id="cor-${p.id}">${cols.map(c=>`<option${c===defC?' selected':''}>${c}</option>`).join('')}</select></label><br>
        <label>Tamanho: <select id="tam-${p.id}">${szs.map(s=>`<option${s===defS?' selected':''}>${s}</option>`).join('')}</select></label><br>
        <button id="btn-${p.id}">Adicionar ao Carrinho</button>
      `;
    }
    list.appendChild(card);
  });
  initProductListeners();
}

function initProductListeners() {
  products.forEach(p => {
    const card = document.getElementById(`prod-${p.id}`);
    const colEl = card.querySelector(`#cor-${p.id}`);
    const szEl = card.querySelector(`#tam-${p.id}`);
    if (colEl) colEl.addEventListener('change', () => refreshOptions(p.id));
    if (szEl) szEl.addEventListener('change', () => refreshOptions(p.id));
    const btn = card.querySelector('button');
    if (btn) btn.addEventListener('click', () => addToCart(p.id));
  });
}

function refreshOptions(id) {
  const card = document.getElementById(`prod-${id}`);
  const colEl = card.querySelector(`#cor-${id}`);
  const szEl = card.querySelector(`#tam-${id}`);
  const selC = colEl.value, selS = szEl.value;
  const avail = Object.entries(inventory[id]).filter(([_,q])=>q>0);
  const cols = [...new Set(avail.map(([k])=>k.split('|')[0]))];
  const szs = [...new Set(avail.map(([k])=>k.split('|')[1]))];
  colEl.innerHTML = cols.map(c=>`<option${c===selC?' selected':''}>${c}</option>`).join('');
  szEl.innerHTML = szs.map(s=>`<option${s===selS?' selected':''}>${s}</option>`).join('');
  const prod = products.find(x=>x.id===id);
  const price = prod.sizePrices? prod.sizePrices[szEl.value] : prod.price;
  card.querySelector('.price').textContent = `R$${price.toFixed(2)}`;
  const stock = inventory[id][`${colEl.value}|${szEl.value}`] || 0;
  card.querySelector('.stock-label').textContent = `Estoque: ${stock}`;
  const btn = card.querySelector('button');
  btn.disabled = stock < 1;
  btn.classList.toggle('sold-out-btn', stock < 1);
}

function addToCart(id) {
  const card = document.getElementById(`prod-${id}`);
  const col = card.querySelector(`#cor-${id}`).value;
  const sz = card.querySelector(`#tam-${id}`).value;
  const key = `${col}|${sz}`;
  if (inventory[id][key] < 1) return;
  const exist = cart.find(i=>i.id===id && i.color===col && i.size===sz);
  if (exist) exist.quantity++;
  else cart.push({id, color:col, size:sz, quantity:1});
  inventory[id][key]--;
  saveInventory();
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount(); showAlert('Adicionado ao carrinho');
  refreshOptions(id);
}

function renderCartPopup() {
  const cont = document.getElementById('cartItems'); cont.innerHTML = '';
  let total = 0;
  cart.forEach(item => {
    const prod = products.find(p=>p.id===item.id);
    const price = prod.sizePrices? prod.sizePrices[item.size] : prod.price;
    const sub = price * item.quantity;
    total += sub;
    const div = document.createElement('div');
    div.innerHTML = `
      <p>${prod.name} (${item.color}/${item.size}) x${item.quantity} = R$${sub.toFixed(2)}</p>
      <div>
        <span class="qty-btn" onclick="changeQty(${item.id},'${item.color}','${item.size}',-1)">-</span>
        <span>${item.quantity}</span>
        <span class="qty-btn" onclick="changeQty(${item.id},'${item.color}','${item.size}',1)">+</span>
        <button class="remove" onclick="removeFromCart(${item.id},'${item.color}','${item.size}')">Remover</button>
      </div>
    `;
    cont.appendChild(div);
  });
  document.getElementById('cartTotal').textContent = `Total: R$${total.toFixed(2)}`;
}

function changeQty(id, color, size, delta) {
  const key = `${color}|${size}`;
  const item = cart.find(i=>i.id===id && i.color===color && i.size===size);
  if (!item || delta > 0 && inventory[id][key] < 1) return;
  item.quantity += delta;
  inventory[id][key] -= delta;
  if (item.quantity <= 0) cart = cart.filter(i=>i!==item);
  saveInventory();
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount(); renderCartPopup(); refreshOptions(id);
}

function removeFromCart(id, color, size) {
  const key = `${color}|${size}`;
  const item = cart.find(i=>i.id===id && i.color===color && i.size===size);
  if (!item) return;
  inventory[id][key] += item.quantity; saveInventory();
  cart = cart.filter(i=>i!==item);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount(); renderCartPopup(); refreshOptions(id);
}

function checkout() {
  if (!cart.length) { showAlert('Carrinho vazio'); return; }
  const phone = '5541999737694';
  let msg = '';
  let total = 0;
  cart.forEach(item => {
    const prod = products.find(p=>p.id===item.id);
    const price = prod.sizePrices? prod.sizePrices[item.size] : prod.price;
    const sub = price * item.quantity;
    total += sub;
    msg += `- ${prod.name} (${item.color}/${item.size}) x${item.quantity} = R$${sub.toFixed(2)}%0A`;
  });
  msg = `Olá, gostaria de comprar:%0A${msg}%0A*Total final: R$${total.toFixed(2)}*`;
  window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
  cart = []; localStorage.removeItem('cart');
  updateCartCount(); renderCartPopup(); closeCart();
}

function toggleCartPopup() { renderCartPopup(); document.getElementById('cartPopup').style.display = 'flex'; }
function closeCart() { document.getElementById('cartPopup').style.display = 'none'; }
function updateCartCount() { document.getElementById('cartCount').textContent = cart.reduce((a,i)=>a+i.quantity,0); }
function showAlert(text) { const d = document.createElement('div'); d.className='custom-alert'; d.textContent=text; document.body.appendChild(d); setTimeout(()=>d.remove(),2000); }
function scrollToTop() { window.scrollTo({top:0,behavior:'smooth'}); }
window.addEventListener('scroll', ()=>{ document.getElementById('btnTop').style.display = window.scrollY>300 ? 'block' : 'none'; });
document.addEventListener('DOMContentLoaded', ()=>{ renderProducts(); updateCartCount(); });

  </script>
</body>
</html>
